export PLUGIN_EUNOMIA_NAME=gvm

####### BASE #######
export PLUGIN_EUNOMIA_GIT_DIR=${PLUGIN_DATA}/git/repo
export PLUGIN_EUNOMIA_BUILD_DIR=${PLUGIN_DATA}/build
export PLUGIN_EUNOMIA_EXPORT_DIR=${PLUGIN_DATA}/export
export PLUGIN_EUNOMIA_LOG_DIR=${PLUGIN_DATA}/log
#######
# Git Repo PKG TMP DIR
export PLUGIN_EUNOMIA_TMP_DIR=${PLUGIN_DATA}/tmp
# Dockerfiles
export PLUGIN_EUNOMIA_DOCKERFILES_DIR=${PLUGIN_DIR}/config/dockerfiles
export PLUGIN_EUNOMIA_DOCKER_CONTAINER_PREFIX=zmicro_plugin_eunomia_
# Service
export PLUGIN_EUNOMIA_SERVICE_NAME=zmicro_plugin_eunomia
export PLUGIN_EUNOMIA_SERVICE_PORT=${PLUGIN_EUNOMIA_SERVICE_PORT:-9000}
# Docker
export PLUGIN_EUNOMIA_DOCKER_REGISTRY=${PLUGIN_EUNOMIA_DOCKER_REGISTRY:-"docker-ta.thinkingdata.cn"}
# Queue
export PLUGIN_EUNOMIA_TASK_QUEUE_IS_ENABLED=${PLUGIN_EUNOMIA_TASK_QUEUE_IS_ENABLED:-"true"}
export PLUGIN_EUNOMIA_TASK_QUEUE_COCURRENCY=${PLUGIN_EUNOMIA_TASK_QUEUE_COCURRENCY:-"2"}
export PLUGIN_EUNOMIA_TASK_QUEUE_LOCK=${PLUGIN_EUNOMIA_TASK_QUEUE_LOCK:-"/tmp/zmicro_plugin_eunomia_task_queue.lock"}

####### Build #######
# Download
export PLUGIN_EUNOMIA_DOWNLOAD_GIT_PKG=$PLUGIN_EUNOMIA_DOWNLOAD_GIT_PKG
# BUILD
export PLUGIN_EUNOMIA_BUILD_GIT_DIR=$PLUGIN_EUNOMIA_GIT_DIR/$PLUGIN_EUNOMIA_BUILD_ID
export PLUGIN_EUNOMIA_BUILD_GIT_DOT_ENV=$PLUGIN_EUNOMIA_BUILD_GIT_DIR/.eunomia
#
export PLUGIN_EUNOMIA_BUILD_ID=${PLUGIN_EUNOMIA_BUILD_ID:-$EUNOMIA_BUILD_ID}
export PLUGIN_EUNOMIA_BUILD_TIMESTAMP=${PLUGIN_EUNOMIA_BUILD_TIMESTAMP:-$(date)}
export PLUGIN_EUNOMIA_BUILD_ID_DIR=$PLUGIN_EUNOMIA_BUILD_DIR/$PLUGIN_EUNOMIA_BUILD_ID
export PLUGIN_EUNOMIA_BUILD_GIT_PKG=${PLUGIN_EUNOMIA_GIT_DIR}/$PLUGIN_EUNOMIA_BUILD_ID.tar.gz
# LOG
export PLUGIN_EUNOMIA_BUILD_ID_LOG=$PLUGIN_EUNOMIA_BUILD_ID_DIR/log.eunomia
# EXPORT
export PLUGIN_EUNOMIA_EXPORT_RUNNER_NAME=${PLUGIN_EUNOMIA_DOCKER_CONTAINER_PREFIX}${PLUGIN_EUNOMIA_BUILD_ID}
# 指定容器构建产物目录，默认是 /var/www/html
export PLUGIN_EUNOMIA_EXPORT_RUNNER_DIST_DIR=${PLUGIN_EUNOMIA_EXPORT_RUNNER_DIST_DIR:-$EUNOMIA_EXPORT_RUNNER_DIST_DIR}
if [ -z "$PLUGIN_EUNOMIA_EXPORT_RUNNER_DIST_DIR" ]; then
  PLUGIN_EUNOMIA_EXPORT_RUNNER_DIST_DIR="/var/www/html"
fi
#
export PLUGIN_EUNOMIA_EXPORT_ID_DIR=${PLUGIN_EUNOMIA_EXPORT_DIR}/$PLUGIN_EUNOMIA_BUILD_ID
export PLUGIN_EUNOMIA_EXPORT_ID_PKG=${PLUGIN_EUNOMIA_EXPORT_ID_DIR}.tar.gz

if [ -z "$PLUGIN_EUNOMIA_DOCKER_REGISTRY" ]; then
  log::error "[eunomia::build] PLUGIN_EUNOMIA_DOCKER_REGISTRY is required"
  return 1
fi

if [ ! -d "$PLUGIN_EUNOMIA_GIT_DIR" ]; then
  mkdir -p $PLUGIN_EUNOMIA_GIT_DIR
fi

if [ ! -d "$PLUGIN_EUNOMIA_BUILD_DIR" ]; then
  mkdir -p $PLUGIN_EUNOMIA_BUILD_DIR
fi

if [ ! -d "$PLUGIN_EUNOMIA_EXPORT_DIR" ]; then
  mkdir -p $PLUGIN_EUNOMIA_EXPORT_DIR
fi

if [ ! -d "$PLUGIN_EUNOMIA_LOG_DIR" ]; then
  mkdir -p $PLUGIN_EUNOMIA_LOG_DIR
fi

if [ ! -d "$PLUGIN_EUNOMIA_TMP_DIR" ]; then
  mkdir -p $PLUGIN_EUNOMIA_TMP_DIR
fi
